# How Kubelet Communicates with the Kubernetes API Server

This document explains **how the kubelet talks to the API Server**, what protocols are used, how authentication works, and what data flows in each direction. This is core to understanding Kubernetes node architecture.

---

## 1. High‚ÄëLevel Overview

Kubernetes follows a **hub-and-spoke model**:

* The **API Server** is the hub (single source of truth)
* **Kubelets** are spokes running on every worker node

üëâ **All communication is initiated by the kubelet**. The API Server never pushes data to nodes.

---

## 2. Communication Diagram (Conceptual)

```
+--------------------+            HTTPS (REST)
|                    | <----------------------------------+
|   Kubernetes       |                                    |
|   API Server       |                                    |
|                    | ---------------------------------> |
+--------------------+        Responses / Watch Streams   |
        ^                                                     
        |                                                     
        |                                                     
+--------------------+                                      
|                    |                                      
|     Kubelet        |                                      
|  (on Worker Node)  |                                      
|                    |                                      
+--------------------+                                      
        |
        | gRPC / CRI
        v
+--------------------+
| Container Runtime  |
| (containerd / CRI-O)
+--------------------+
```

---

## 3. Transport & Protocol

### üîê Transport

* **Protocol:** HTTPS
* **Port:** 6443 (default)
* **Encryption:** TLS

Kubelet uses **REST APIs** exposed by the API Server.

---

## 4. Authentication: How Kubelet Proves Its Identity

### Common Methods

#### 1Ô∏è‚É£ Client Certificates (Most Common)

* Kubelet uses a client cert:

  * `/var/lib/kubelet/pki/kubelet-client.crt`
* Identified as:

  ```
  system:node:<node-name>
  ```
* Belongs to group:

  ```
  system:nodes
  ```

#### 2Ô∏è‚É£ Bootstrap Token (Initial Join)

* Used only during `kubeadm join`
* Temporary access to request a certificate

---

## 5. Authorization: What Kubelet Is Allowed to Do

Authorization is controlled via **Node Authorizer** + **RBAC**.

Kubelet is allowed to:

* Read Pods scheduled on itself
* Update Node status
* Update Pod status
* Post events

üö´ Kubelet **cannot**:

* Read secrets of other nodes
* Modify cluster-wide resources

---

## 6. What Data Flows FROM Kubelet ‚Üí API Server

### 1Ô∏è‚É£ Node Status Updates (Heartbeat)

* CPU, memory, disk
* Conditions (Ready, DiskPressure, MemoryPressure)

```
PUT /api/v1/nodes/<node-name>/status
```

---

### 2Ô∏è‚É£ Pod Status Updates

* Container state (Running, CrashLoopBackOff)
* Restart counts

```
PUT /api/v1/namespaces/<ns>/pods/<pod>/status
```

---

### 3Ô∏è‚É£ Events

* Image pull failures
* Container crashes

```
POST /api/v1/namespaces/<ns>/events
```

---

## 7. What Data Flows FROM API Server ‚Üí Kubelet

### 1Ô∏è‚É£ Pod Specifications

Kubelet watches for Pods scheduled on it:

```
GET /api/v1/pods?fieldSelector=spec.nodeName=<node>
```

Uses **watch streams** to get real‚Äëtime updates.

---

### 2Ô∏è‚É£ ConfigMaps & Secrets (Indirect)

* API Server authorizes access
* Kubelet fetches only what pods on that node need

---

## 8. Watch Mechanism (Very Important)

Instead of polling:

* Kubelet opens a **long‚Äëlived watch connection**
* API Server streams changes

Benefits:

* Low latency
* Scales well
* Efficient

---

## 9. Failure Handling

### If API Server Is Down:

* Existing Pods keep running
* No new Pods scheduled
* Node marked `NotReady` after grace period

### If Kubelet Is Down:

* Node becomes `NotReady`
* Pods may be rescheduled elsewhere (after timeout)

---

## 10. Key Points to Remember (Exam + Interview)

* Kubelet **always initiates** communication
* Uses **HTTPS + TLS**
* Auth via **client certificates**
* Authorization via **Node Authorizer + RBAC**
* Uses **watch API**, not polling
* API Server never talks directly to container runtime

---

## 11. One‚ÄëLine Summary

> Kubelet securely communicates with the API Server over HTTPS, watches for Pod assignments, reports node and pod status, and acts as the execution agent for the control plane.
