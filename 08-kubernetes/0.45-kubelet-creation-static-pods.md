# ğŸ§± Static Pods in Kubernetes

> A clean, conceptual, and production-oriented guide to **Static Pods**, written for deep understanding and interviews.

---

## ğŸŒŸ What is a Static Pod?

A **Static Pod** is a Pod that is **managed directly by the kubelet on a node**, without going through the Kubernetes API server for creation.

ğŸ‘‰ The pod YAML lives on the **node filesystem**, and kubelet turns it into a running pod automatically.

---

## ğŸ§  Why Static Pods Exist

Static pods solve Kubernetesâ€™ **bootstrap problem**.

Kubernetes needs some components to run **before the cluster is fully alive**:

* No API server yet
* No scheduler yet
* No controllers yet

âœ… Static pods allow kubelet to start **critical components independently**.

---

## ğŸ”„ How Static Pods Work (Flow)

```text
kubelet starts
  â†“
reads kubelet config
  â†“
finds staticPodPath
  â†“
watches directory for YAML files
  â†“
creates pods directly via container runtime
  â†“
reports status to API server (mirror pod)
```

ğŸŸ¡ The API server only sees a **mirror**, not the real pod.

---

## âš™ï¸ kubelet Configuration (Source of Truth)

Static pods are defined **only in kubelet configuration**, not inside Pod YAML.

Example (from kubelet config):

```yaml
staticPodPath: /etc/kubernetes/manifests
```

ğŸ§© Meaning:

* kubelet watches this directory
* Any valid Pod YAML placed here becomes a static pod

---

## ğŸ“ Static Pod Manifest Location

### Default path (most clusters)

```text
/etc/kubernetes/manifests/
```

### Typical files found here

```text
etcd.yaml
kube-apiserver.yaml
kube-scheduler.yaml
kube-controller-manager.yaml
```

ğŸ“Œ Each file represents **one static pod**.

---

## ğŸ§ª How to Check Static Pods in Minikube (Step-by-Step)

Follow these steps **inside Minikube**, not on your host machine.

### ğŸ”¹ Step 0: SSH into Minikube node

```bash
minikube ssh
```

Your prompt should change to:

```text
docker@minikube:~$
```

---

### ğŸ”¹ Step 1: Check kubelet configuration

```bash
sudo cat /var/lib/kubelet/config.yaml
```

Look for:

```yaml
staticPodPath: /etc/kubernetes/manifests
```

This confirms **where kubelet looks for static pods**.

---

### ğŸ”¹ Step 2: Navigate to static pod directory

```bash
cd /etc/kubernetes/manifests
ls
```

Expected output:

```text
etcd.yaml
kube-apiserver.yaml
kube-controller-manager.yaml
kube-scheduler.yaml
```

âœ… These files confirm that control-plane components are running as **static pods** in Minikube.

---

## ğŸ§© Which Components Are Static Pods?

In **Minikube / kubeadm-based clusters**, these control-plane components run as static pods:

* ğŸ§  **kube-apiserver** â€” cluster entry point
* ğŸ§­ **kube-scheduler** â€” assigns pods to nodes
* ğŸ›ï¸ **kube-controller-manager** â€” runs controllers
* ğŸ—„ï¸ **etcd** â€” stores cluster state

These must exist **even when the API server is unavailable**.

---

## â“ Why Static Pod YAML Does NOT Contain `staticPodPath`

This is a common confusion.

* `staticPodPath` belongs to **kubelet**, not the pod
* Pod YAML only defines **what to run**, not **how it is discovered**

ğŸ§  Rule to remember:

> A pod is static because of **where the file lives**, not because of what is written inside it.

---

## ğŸª Mirror Pods (Important Concept)

Static pods create **mirror pods** in the API server.

### What mirror pods are for

* ğŸ‘€ Visibility via `kubectl`
* ğŸ“Š Monitoring and observability

### What mirror pods cannot do

* âŒ Cannot be edited
* âŒ Cannot be deleted
* âŒ Cannot be controlled by controllers

Deleting a mirror pod simply causes kubelet to recreate it.

---

## ğŸ” How to Identify a Static Pod

### From the node (strongest proof)

```bash
ls /etc/kubernetes/manifests
```

### From the cluster

```bash
kubectl get pods -n kube-system
```

ğŸ” Indicators:

* Pod name includes node name
* No Deployment / ReplicaSet / DaemonSet owner

```yaml
ownerReferences: []
```

---

## ğŸ› ï¸ Creating Your Own Static Pod

### Step 1: Create YAML on the node

```bash
sudo vi /etc/kubernetes/manifests/nginx-static.yaml
```

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-static
spec:
  containers:
  - name: nginx
    image: nginx:latest
    ports:
    - containerPort: 80
```

### Step 2: kubelet takes over

* Pod starts automatically
* No `kubectl apply` needed

```text
nginx-static-<node-name>
```

---

## âœï¸ Modifying or Deleting Static Pods

* ğŸ“ Edit YAML â†’ pod restarts automatically
* ğŸ—‘ï¸ Delete YAML â†’ pod stops

```bash
sudo rm /etc/kubernetes/manifests/nginx-static.yaml
```

---

## âš–ï¸ Static Pod vs Normal Pod

| Feature        | Static Pod | Normal Pod |
| -------------- | ---------- | ---------- |
| Created by     | kubelet    | API server |
| Stored in etcd | âŒ No       | âœ… Yes      |
| Scheduled      | âŒ No       | âœ… Yes      |
| Controller     | âŒ None     | âœ… Yes      |
| Node specific  | âœ… Yes      | âŒ No       |
| Scaling        | Manual     | Automatic  |

---

## ğŸ¯ Real-World Use Cases

### ğŸš€ Control Plane Bootstrapping

* Required to bring the cluster up from zero

### ğŸ›Ÿ Cluster Recovery

* API server down
* Static pods still running

### ğŸ§± Node-Critical Services

* Security agents
* Low-level system services

> In modern setups, DaemonSets are preferred for most node-level workloads.

---

## ğŸš« When NOT to Use Static Pods

Avoid static pods when you need:

* ğŸ”„ Rolling updates
* ğŸ“ˆ Auto-scaling
* ğŸ§© High availability via controllers

Use:

* Deployment
* DaemonSet
* StatefulSet

---

## ğŸ—ï¸ Who Creates Control-Plane Static Pods?

### Two responsibilities, two components

#### ğŸ§¾ Who creates the YAML files?

ğŸ‘‰ **kubeadm** (or Minikube internally)

* Runs during cluster bootstrap
* Generates certificates and kubeconfigs
* Writes static pod manifests to disk

```text
/etc/kubernetes/manifests/
```

Files created:

```text
etcd.yaml
kube-apiserver.yaml
kube-scheduler.yaml
kube-controller-manager.yaml
```

kubeadm runs **once**, then exits.

---

#### âš™ï¸ Who creates and runs the pods?

ğŸ‘‰ **kubelet**

* Watches `staticPodPath`
* Creates containers via container runtime
* Restarts them if they crash

ğŸ§  kubelet is the **runtime owner** of static pods.

---

## ğŸ§¬ Control Plane Bootstrap Timeline

```text
kubeadm init
  â†“
writes static pod YAMLs
  â†“
kubelet starts
  â†“
creates etcd
creates kube-apiserver
creates scheduler
creates controller-manager
  â†“
API server becomes available
```
---

## ğŸš€ How kubelet Itself Is Created (Very Important)

This answers the question: **"If kubelet creates everything, who creates kubelet?"**

---

## ğŸ§© kubelet Is NOT a Kubernetes Pod

- kubelet is **not** created by Kubernetes
- kubelet is **not** scheduled
- kubelet does **not** run inside a pod

ğŸ‘‰ kubelet is a **system service** that runs directly on the node.

---

## ğŸ› ï¸ Who Installs kubelet?

Depending on environment:

### ğŸ–¥ï¸ Minikube

- Minikube provisions the node (VM or container)
- Installs kubelet binary
- Creates a system service for kubelet
- Starts kubelet automatically

Binary location (example):

```text
/var/lib/minikube/binaries/v1.xx.x/kubelet
````

---

### ğŸ§° kubeadm-based clusters

* User installs kubelet via OS package manager

```bash
apt install kubelet
# or
yum install kubelet
```

* kubelet is registered as a **systemd service**
* kubeadm later configures it

---

### â˜ï¸ Managed Kubernetes (EKS / GKE / AKS)

* Cloud provider installs kubelet
* Provider manages upgrades and config
* User does not manage kubelet directly

---

## âš™ï¸ How kubelet Starts

On node boot:

```text
Operating System
  â†“
systemd
  â†“
kubelet service
  â†“
kubelet process
```

kubelet starts **before** the Kubernetes API server is available.

---

## ğŸ“„ kubelet Configuration Files

Common kubelet config locations:

```text
/var/lib/kubelet/config.yaml
/etc/kubernetes/kubelet.conf
```

kubelet uses these to:

* Find API server
* Authenticate
* Discover `staticPodPath`

---

## ğŸ”— kubelet Bootstrap Relationship

```text
OS / systemd
  â†’ kubelet
      â†’ static pods
          â†’ etcd
          â†’ kube-apiserver
              â†’ scheduler
              â†’ controller-manager
```

This ordering solves the Kubernetes chicken-and-egg problem.

---

## ğŸ§  Key Takeaways

* Static pods are **kubelet-managed**, not API-managed
* YAML lives on the **node filesystem**
* `staticPodPath` is kubelet configuration
* Control-plane components are static pods
* Mirror pods provide visibility only

---

## ğŸ’¬ Interview One-Liner

> A static pod is a pod managed directly by the kubelet using local manifest files, commonly used for control-plane components to avoid dependency on the Kubernetes API server.
